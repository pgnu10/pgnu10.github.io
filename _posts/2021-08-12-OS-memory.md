---
title: '[CS] 운영체제: 메모리 계층 구조'
excerpt: '메모리 계층 구조, 레지스터, 캐시, 메인 메모리, 디스크에 대해 알아봅니다.'
categories:
  - Computer_Science
tags:
  - 운영체제
  - 메모리 계층 구조
  - 레지스터
  - 캐시
  - 메인 메모리
  - 디스크
toc: true
toc_sticky: true
date: '2021-08-12'
---

# 메모리 계층 구조 (Memory Hierarchy)

<p align="center"><img src="/assets/images/memory_hierarchy.png"></p>

빠른 저장 장치는 처리 속도는 빠르지만 용량에 비해 가격이 비싸고, 느린 저장 장치는 용량에 비해 가격이 싸지만 처리 속도가 느립니다.

우리의 목표는 빠른 속도가 필요한 작업에는 빠른 저장 장치를 사용하고, 속도보다 용량이 중요한 작업에는 느린 저장 장치를 사용하여 싸고 적절히 성능 좋은 컴퓨터를 설계하는 것입니다.

- 예를 들어 자주 사용하고 중요한 역할을 하는 운영체제는 SSD에, 용량은 크지만 사용 작업이 단순한 동영상, 사진 등은 HDD에 저장하는 식입니다.

이러한 목표를 달성하기 위해 메모리를 종류별로 계층화하여 정리합니다. 메모리 계층 구조는 컴퓨터 설계에서 여러 종류의 저장 장치를 함께 사용하여 최적의 효율을 얻고자 메모리의 종류를 계층화한 것입니다.

## 메모리의 두가지 요건

1. 대역폭 (Throughput): 같은 시간 안에 얼마나 많은 데이터를 옮길 수 있는지에 대한 능력으로 입출력 속도를 의미합니다.
2. 용량 (Capacity): 메모리에 닮을 수 있는 데이터의 총량을 의미합니다.

일반적으로 입출력 속도가 빠를수록, 용량이 클수록 메모리의 가격은 올라갑니다.

## 메모리의 종류

메모리를 속도와 가격에 따라 "레지스터", "캐시", "메인 메모리", "디스크" 로 나누어 계층화합니다.

### 1. 레지스터

레지스터는 컴퓨터의 프로세서 내에 위치한 가장 빠른 메모리입니다.

레지스터는 극히 소량의 데이터, 혹은 처리 중인 중간 결과 같은 프로세서가 바로 사용할 수 있는 데이터를 담고 있습니다. 따라서 CPU의 계산 과정에서 작동합니다.

- 용량은 내 컴퓨터 정보에서 볼 수 있는 시스템의 비트(32 bit, 64 bit)와 동일하며, 정수형(int)과 실수형(float) 데이터만을 저장할 수 있습니다.

용도에 따라 [전용 레지스터와 범용 레지스터]로 나뉘고, 저장되는 데이터의 종류에 따라 [데이터 레지스터, 주소 레지스터, 상태 레지스터]로 나뉩니다. 또한 사용자의 정보 변경 가능 여부에 따라 [사용자 가시 레지스터와 사용자 불가시 레지스터]로 나뉩니다.

### 2. 캐시 메모리

캐시 메모리는 레지스터 다음으로 빠른 메모리입니다. 메인 메모리에서 가장 자주 사용되는 위치의 데이터를 갖고 있습니다.

Cache란 '은닉된'이라는 뜻으로, 자주 사용되는 데이터를 본래의 장소보다 더 접근 시간이 빠른 별도의 장소에 저장합니다. 이를 통해 데이터 접근 속도를 높여 빠른 장치와 느린 장치 사이의 병목현상을 해결하려는 목적으로 사용됩니다.

캐시 메모리는 **데이터 지역성**의 원리를 이용하여 메모리 접근 효율성을 높힙니다.

CPU와의 거리에 따라 L1 캐시, L2 캐시 등 여러 단계로 나뉩니다. L1이 가장 가깝습니다.

- 상위 레벨 캐시들은 보통 **SRAM**으로 구성됩니다.

보통 사용자가 직접 제어할 수 없으며, CPU에 의해 자동으로 통제됩니다.

일반적으로 CPU 내부 캐시 메모리를 가리키지만, GPU 내부의 캐시도 있고, 웹 캐시처럼 소프트웨어 캐시도 있습니다.

#### 데이터 지역성 (Data Locality)

캐시는 자주 사용되는 데이터를 저장합니다. 그러나 이를 수행하려면 CPU가 어떤 데이터를 원할 것인가를 예측할 수 있어야 합니다. 이때 사용하는 것이 데이터 지역성의 원리입니다.

데이터 지역성이란 프로그램이 한번 접근한 데이터의 위치에 대해, 해당 위치의 근방은 프로그램이 가까운 시간 내에 다시 접근할 가능성이 높다는 성질입니다.

데이터 지역성은 "프로그램은 저장된 모든 데이터에 균등하게 액세스하지 않는다"는 성질을 전제합니다. 이와는 반대로 "특정 부분에 집중적으로 참조한다"는 것이 데이터 지역성입니다.

데이터 지역성은 다음 3가지로 나눌 수 있습니다.

- 시간적 지역성: 최근 액세스 된 기억 장소는 가까운 미래에 다시 액세스 될 가능성이 높음
- 공간적 지역성: 액세스 된 기억장소와 인접한 위치가 액세스 될 가능성이 높음
- 순차적 지역성: 일반적으로 명령어들은 메모리에 저장딘 순서대로 인출되어 실행됨

데이터 지역성에 따르면 대부분의 메모리 접근은 특정 위치 근방에서 자주 일어나기 때문에, 데이터를 크기는 작지만 속도가 빠른 캐시 메모리에 복사해두면 평균 메모리 접근 시간을 아낄 수 있습니다.

캐시 메모리는 이 특성에 기반하여 한번 액세스가 요청된 위치의 근방을 복사하여 저장해둡니다. 프로세서는 메인 메모리를 읽거나 쓸 때 먼저 그 주소에 해당하는 데이터가 캐시에 존재하는지 살핍니다. 존재한다면 캐시에서 직접 읽고, 그렇지 않다면 메인 메모리에 직접 접근하여 읽습니다.

#### SRAM (Static RAM)

정적 RAM이라고도 부르며 휘발성 RAM의 한 종류입니다.

플립플롭이라는 논리 회로를 사용하여, 내용을 한번 기록하면 전원이 공급되는 한 내용을 그대로 보존하는 RAM 입니다.

- 플립플롭 (Flip-Flop): 어떤 입력을 받으면 그 입력을 초기화하도록 하는 명령을 받기 전까지 내부에서 루프를 돌려서 유지하는 회로입니다. 혹은 외부로부터의 에너지 공급이 없을 시 에너지 손실로 빠른 시간 안에 정지합니다.

메인 메모리로 주로 사용되는 DRAM보다 100배 이상 데이터 접근 속도가 빠르지만, 구조가 복잡하여 공간을 많이 차지하기 때문에 집적도를 높이기 어렵습니다. 때문에 가격이 비싸고 대용량으로 제작하기 어렵습니다.

이런 특성 때문에 빠른 속도가 요구되는 상위 레벨 캐시 메모리에 주로 사용됩니다.

### 3. 메인 메모리 (주기억장치)

CPU에서 직접 접근이 가능한 메모리로, **RAM**과 **ROM**이 존재합니다. 일반적으로 RAM을 가르킵니다.

  - RAM은 BIOS가 담겨진 ROM과 함께 메인 메모리로 취급되지만, 읽기만 가능한 ROM과는 달리 임의 접근하여 자유롭게 사용할 수 있습니다.
  
CPU에서 직접 접근이 가능하지만 상수를 쓰는 것 이외의 연산은 CPU에서 바로 수행할 수 없으며, 메모리의 값을 레지스터로 "로드 - 연산 - 결과 적용" 의 단계를 거쳐야 합니다.

가정용 PC의 경우 주로 **DRAM**으로 구성됩니다. HDD, SSD와는 비교도 안되는 속도를 보여줍니다.

#### RAM (Random Access Memory)

사용자가 원할 때 자유롭게 내용을 읽고, 쓰고, 지울 수 있는 메모리입니다. 

어느 위치에 저장된 데이터든지 접근하는 데에 동일한 시간이 걸리는 메모리이기에 Random 이라는 이름이 붙었습니다.

용어 자체는 어떤 데이터든 접근하는 데에 동일한 시간이 걸리는 메모리를 의미하기에, 메인 메모리뿐만 아니라 버퍼 메모리, 캐시 메모리, 스토리지 디스크 용으로 사용하는 RAM도 있습니다. 그러나 일반적으로는 메인 메모리 RAM을 의미합니다.

#### ROM (Read Only Memory)

ROM은 기억된 내용을 읽을 수만 있는 기억장치로, 전원이 꺼져도 저장된 내용이 지워지지 않는 비휘발성 메모리 입니다.

그래서 ROM은 주로 기본 입출력 시스템(BIOS), 자가 진단 프로그램(POST) 같은 변경 가능성이 적은 시스템 소프트웨어를 저장하는 데에 이용합니다.

#### DRAM (Dynamic RAM)

최근의 RAM이라는 단어는 가정용 PC 메인 메모리의 RAM, 즉 휘발성 RAM (VRAM: Volatile RAM) 중에서도 DRAM (Dynamic RAM)을 가리킵니다.

휘발성 RAM은 컴퓨터가 켜지는 순간부터 동작에 필요한 내용들이 저장되기 시작하며, 전원이 꺼지면 저장된 데이터가 모두 사라지는 휘발성을 가진 메모리입니다.

- 축전기를 사용하여 축전기의 충전 상태로 정보를 기록하고 보존합니다.

DRAM은 SRAM에 비해 속도가 느리지만 구조가 간단하여 집적도를 쉽게 높일 수 있습니다. 따라서 가격이 매우 싸고 소비 전력도 크지 않아 CPU의 메인 메모리로 가장 많이 사요되고 있습니다.

### 4. Disk (Storage)

CPU에서 직접 접근이 불가능한 메모리로, 접근하려면 디바이스 드라이버와 시스템 콜을 통해 메모리의 특정 위치의 내용을 로드(Load)한 뒤 접근해야 합니다.

**HDD**, **SSD**, CD 등이 이 분류에 속합니다.

#### HDD (Hard Disk Drive)

하드 디스크는 비휘발성의 순차 접근이 가능한 컴퓨터 보조 기억장치입니다.

비휘발성 데이터 저장장치 중 가장 대중적이고 저렴합니다. 

자기장의 원리를 이용, 자성 물질이 있는 원판(disk)에 자기를 정렬하는 원리로 정보를 기록하거나 지웁니다. 이 원판을 물리적으로 회전시켜 기계 팔(헤드)이 접근하고자 하는 데이터 위치에 오도록 한 뒤 데이터를 읽습니다.

#### SSD (Solid State Drive)

기계식으로 작동하는 HDD와 달리, SDD는 순수 전자식으로 작동합니다. 

따라서 HDD의 단점이었던 긴 탐색 시간, 긴 반응 시간, 기계적 지연, 거대한 크기와 무게, 실패율, 소음 등을 해결하였습니다.

## 참고자료

<details><summary>펼치기</summary>
<div markdown="1">
- http://cs.uwec.edu/~buipj/teaching/cs.352.f12/static/image/memory_hierarchy.png
- https://velog.io/@ckstn0777/%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B5%AC%EC%A1%B0-75yk3fno
- https://namu.wiki/
- https://ko.wikipedia.org/wiki/%EB%A9%94%EB%AA%A8%EB%A6%AC_%EA%B3%84%EC%B8%B5_%EA%B5%AC%EC%A1%B0
- https://github.com/JaeYeopHan/Interview_Question_for_Beginner/tree/master/OS#%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%9D%98-%EC%B0%A8%EC%9D%B4
</div>
</details>
