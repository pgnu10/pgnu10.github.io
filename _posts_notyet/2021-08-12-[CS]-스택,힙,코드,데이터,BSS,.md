---
title: '[CS] 운영체제: 스택, 힙, 코드, 데이터, BSS 영역'
excerpt: '스택, 힙, 코드, 데이터, BSS 영역에 대해 알아봅니다.'
categories:
  - Computer Science
tags:
  - 기술면접 준비
  - 운영체제
  - 스택
  - 힙
  - 코드
  - 데이터
  - BSS 영역
  - 비전공자를 위한
toc: true
toc_sticky: true
date: '2021-08-12'
lastmod: '2022-01-16'
---

# 프로세스와 스레드

프로세스는 메모리에 올라와 실행되고 있는 프로그램으로, 운영체제로부터 시스템 자원을 할당받는 작업의 단위입니다. 간단히 말하면 실행된 프로그램을 말합니다. 

프로세스는 운영체제로부터 **코드, 데이터, 스택, 힙**이라는 독립적인 메모리 영역을 할당 받습니다.

스레드는 프로세스 내에서 실행되는 여러 흐름의 단위를 나타냅니다. 즉, 프로세스가 할당받은 자원을 이용하는 실행의 단위입니다.

한 프로세스 내의 스레드는 **스택** 영역만 독립적으로 할당받고, **코드, 데이터, 힙** 영역은 같은 프로세스 내의 스레드들끼리 공유하게 됩니다.

## 스택, 힙, 코드, 데이터, BSS 영역

![ex_screenshot](/assets/images/memory_structure.png)

OS에서 프로세스가 바라보는 메모리 영역은 크게 코드(Code), 데이터(Data), 힙(Heap), 스택(Stack) 영역으로 나뉘어져 있습니다.

### Code 영역 (= text 영역)

프로세스가 실행할 코드와 매크로 상수가 기계어의 형태로 저장된 공간입니다.

컴파일 타임에 만들어지고 실행 중간에 코드를 바꿀 수 없게 Read-Only로 저장됩니다.

### Data 영역

코드에서 선언한 전역변수 및 static 변수, 배열 (array), 구조체 (structure) 등이 저장된 공간입니다. 

- 전역변수나 static 변수를 선언할 때 초기값이 있다면 먼저 초기화한 뒤 초기값을 할당합니다.
- 선언된 변수들 값을 참조한 코드는 컴파일하고 나면 Data 영역의 주소값을 가르키도록 바뀝니다.

실행 도중에 전역변수가 변경될 수도 있으니, 이 영역은 Read-Write로 지정됩니다.

선언 시 초기화할 필요가 없는 전역 변수는 BSS 영역에 할당됩니다.

#### BSS (Block Started by Symbol) 영역

BSS란 선언 시 초기화할 필요가 없는 전역 변수를 할당하는 영역입니다.

BSS 영역에서는 메모리 상 공간만 잡아두고 실제로 수를 초기화 시키지 않습니다. 대신 어느 정도의 공간의 크기를 저장할 것이라는 정보를 저장합니다.

데이터 영역은 프로그램의 실행 초기에 사용할 메모리를 확보하는 반면, BSS 영역은 런타임 후에야 메모리 영역을 확보합니다. 즉, 메모리 사용면에서는 BSS 영역이 효율적입니다.

### Stack 영역

Stack은 프로세스의 메모리 공간을 관리하기 위한 자료구조 (data structure) 알고리즘 중 하나입니다. 값을 기록하고 종료하는 매커니즘으로 후위선출 (LIFO: Last In First Out) 방식을 사용합니다.

함수 안에서 선언된 지역변수, 매개변수, 리턴값, 돌아올 주소 등등이 저장되고, 함수 호출시 기록하고 종료되면 제거합니다.

컴파일 타임에 크기가 결정되기 때문에 무한히 할당 할 수 없습니다. 재귀 함수 등이 너무 깊게 호출되거나 함수가 지역변수를 너무 많이 가지고 있어서 stack 영역을 초과할 경우 stack overflow 에러가 발생합니다.

- 4 bit는 0 부터 15까지의 10진수를 2진수로 표현할 수 있습니다. (15 = 1111) 여기에 16이라는 수를 2진수로 표현하려 한다면 (16 = 10000), 4 bit로 표시할 수 있는 수는 0000이 되어 가장 작은 값으로 표시됩니다. 이러한 에러를 stack overflow 라고 합니다.

### Heap 영역

프로그래머가 필요할 때마다 사용하는 메모리 영역으로, 다른 영역들과는 다르게 Heap은 런타임에 결정됩니다. 데이터 배열의 크기가 확실하지 않고 변동이 있을 때에 Heap 영역을 활용해서 메모리를 할당합니다.

- C언어에서는 malloc, calloc으로 Heap 영역의 메모리를 사용할 수 있습니다. (**동적 메모리 할당**)

사용하고 난 뒤에는 반드시 해제를 해야하며,그렇지 않으면 메모리 누수 (memory leak)가 발생합니다.

stack보다 할당할 수 있는 메모리 공간이 많다는 것이 장점이지만, 포인터로 메모리 영역을 접근해야 하기 때문에 다른 자료 구조에 비해서 데이터를 읽고 쓰는게 느립니다.

## 동적 메모리 할당

프로그램이 시작하기 전에 사용할 메모리 공간을 정해놓고 시작하는 방식을 정적 (static) 메모리 할당이라고 합니다. C 언어에서 `char name [100]`과 같은 식으로 변수를 선언하는 방식입니다.

그러나 이 방식의 경우, 만약 사용자의 입력이 미리 선언한 공간보다 너무 적거나 혹은 그보다 클 경우 오류나 메모리 낭비가 발생할 수 있습니다. 정적 할당은 직관적이고 구현이 쉽지만 메모리의 정확한 사용량을 알지 못한채 사용하게 되면 이러한 문제가 발생합니다.

동적 할당은 이 문제를 해결하기 위해 프로그램이 시작된 후에 필요에 따라서 그때 그때 메모리를 할당하고 저장하는 방식입니다. 메모리를 효율적으로 사용할 수 있지만, 구현이 어렵다는 단점이 있습니다. C 언어에서는 `malloc, realloc, calloc`을 사용합니다.

## 참고자료

<details><summary>펼치기</summary>
<div markdown="1">

- https://gracefulprograming.tistory.com/22
- https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html
- https://ko.wikipedia.org/wiki/%EC%9A%B4%EC%98%81_%EC%B2%B4%EC%A0%9C
- https://blog.naver.com/NBlogTop.naver?isHttpsRedirect=true&blogId=sharonichoya&Redirect=Dlog&Qs=/sharonichoya/220501158281
- https://dev-ahn.tistory.com/15
- https://github.com/JaeYeopHan/Interview_Question_for_Beginner/tree/master/OS#%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%9D%98-%EC%B0%A8%EC%9D%B4
- https://parkcheolu.tistory.com/19

</div>
</details>

