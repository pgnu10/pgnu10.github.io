---
title: '[CS] 운영체제: 프로세스와 스레드'
excerpt: '운영체제, 프로세스, 스레드에 대해 알아봅니다.'
categories:
  - Computer Science
tags:
  - 기술면접 준비
  - 운영체제
  - 프로세스
  - 스레드
  - 멀티 프로세스
  - 멀티 스레드
  - 비전공자를 위한
toc: true
toc_sticky: true
date: '2021-08-11'
lastmod: '2022-01-16'
---

# 운영체제

Operating System, 운영체제란 우리의 프로그램이 컴퓨터에서 동작할 수 있도록 하는 구동 환경. 즉, 소프트웨어가 하드웨어와 연결이 되기 위한 기반 시스템을 말합니다.

운영체제는 컴퓨터의 "자원 관리", "메모리 관리", "**프로세스** 관리", "입출력장치 관리", "파일(데이터) 관리", "시스템 관리", "시스템 보호", "네트워킹", "명령 해석기" 등의 역할을 수행합니다.

대표적으로 Windows, MacOS, Linux 등이 있으며 어플리케이션은 운영체제에 Dependent 하기 때문에 어떤 개발 환경에서 개발을 할 것인지 먼저 선택해야 합니다.

## 프로세스와 스레드

<p align="center"><img src="/assets/images/Concepts-_Program_vs._Process_vs._Thread.jpg"></p>

### 프로세스 Process

프로세스는 메모리에 올라와 실행되고 있는 프로그램으로, 운영체제로부터 시스템 자원을 할당받는 작업의 단위입니다. 간단히 말하면 실행된 프로그램을 말합니다. 

프로세스는 운영체제로부터 **코드, 데이터, 스택, 힙**이라는 독립적인 메모리 영역을 할당 받습니다.

- 스택: 함수의 매개변수, 복귀 주소, 로컬 변수와 같은 임시 자료를 저장하는 곳
- 데이터 섹션: 전역 변수들을 수록하는 곳
- 힙: 프로세스 실행 중에 동적으로 할당되는 메모리

각 프로세스는 별도의 주소 공간에서 실행되며, 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없습니다. 다른 프로세스의 자원에 접근하려면 프로세스 간의 통신을 사용해야 합니다.

#### 프로세스 제어 블록 Process Control Block, PCB

PCB는 특정 프로세스에 대한 중요한 정보를 저장하고 있는 자료구조입니다. 

운영체제는 프로세스를 관리하기 위해 프로세스의 생성과 동시에 고유한 PCB를 생성합니다. 프로세스는 CPU를 할당 받아 작업을 처리하다가 프로세스 전환이 발생하면 진행하던 작업을 모두 PCB에 저장한 뒤 CPU를 반환합니다. 이후 다시 CPU를 할당받게 되면 PCB에 저장되어 있던 내용을 불러와 종료됐던 시점부터 작업을 재개합니다.

PCB에 저장되는 정보는 다음과 같습니다.

- 프로세스 아이디 (Process ID, PID)
- 프로세스 상태: new, ready, running, waiting, terminated 등
- 프로그램 카운터: 프로세스가 다음에 실행할 명령어의 주소
- CPU 레지스터
- CPU 스케쥴링 정보: 프로세스의 우선순위, 스케쥴 큐에 대한 포인터 등
- 메모리 관리 정보: 페이지 테이블 또는 세그먼트 테이블 등
- 입출력 상태 정보: 프로세스에 할당된 입출력 장치들과 열린 파일 목록
- 어카운팅 정보: 사용된 CPU 시간, 시간제한, 계정번호 등

### 스레드 Thread

스레드는 프로세스 내에서 실행되는 여러 흐름의 단위를 나타냅니다. 즉, 프로세스가 할당받은 자원을 이용하는 실행의 단위입니다.

- 기본적으로 프로세스당 최소 1개의 스레드를 가지고 있습니다.

스레드는 스레드 ID, 프로그램 카운터, 레지스터 세트, 스택으로 구성되어 있습니다.

한 프로세스 내의 스레드는 **스택** 영역만 독립적으로 할당받고, **코드, 데이터, 힙** 영역은 같은 프로세스 내의 스레드들끼리 공유하게 됩니다.

- 스레드는 스택 영역을 공유하기 때문에 한 자원에 대한 동시 접근인 **Race Condition**으로 인한 데이터의 오류가 발생할 수 있습니다. 따라서 쓰레드 간의 실행 순서를 정해줘야 합니다.
- 하나의 프로세스를 다수의 실행 단위인 스레드로 구분하여 자원을 공유하고 자원의 생성과 관리의 중복성을 최소화하여 수행능력을 향상시키는 것을 **멀티 스레딩**이라고 합니다. 
- 이 경우 각각의 스레드는 독립적인 작업을 수행하기 때문에 각자의 스택과 PC 레지스터 값을 갖습니다.

#### 스택을 스레드마다 독립적으로 할당하는 이유

스택(stack)은 함수 호출 시 전달되는 인자, 되돌아갈 주소값 및 함수 내에서 선언하는 변수 등을 저장하기 위해 사용되는 메모리 공간입니다.

스택을 독립적으로 할당받는다는 것은 독립적인 함수 호출이 가능하다는 것입니다. 따라서, 스레드는 독립적인 실행이 가능해야 하기 때문에 독립된 스택을 할당받는 것입니다.

#### Race Conditions 경쟁 조건

race condition 이란 critical sections (임계 구역) 안에서 일어날 수 있는 특별한 상태를 말합니다.

- critical sections 이란 여러 스레드에 의해 실행되는 코드 지역으로, 스레드들의 실행 순서에 따라 코드 실행 결과가 달라질 때 해당 critical section은 race condition을 가진다고 합니다.

이는 여러 스레드가 같은 자원에 접근할 경우 발생하는 문제로, 메모리(변수, 배열, 객체), 시스템(데이터 베이스, 웹 서비스 등), 파일과 같은 자원에 하나 이상의 스레드가 write 할 경우 발생합니다.

따라서 이를 방지하기 위해서는 하나의 스레드가 실행할 때 다른 스레드는 실행중인 스레드가 critical section을 나오기 전까지 실행할 수 없게 만드는 것이 필요합니다. 

즉, 적절한 스레드 동기화를 통해 피할 수 있습니다.

## 멀티 프로세스와 멀티 스레드

### 멀티 프로세스 Multi Process

멀티 프로세스는 2개 이상의 프로세서(CPU)가 하나 이상의 작업을 동시에 (병렬적으로) 처리하는 것입니다.

프로세스는 스택, 코드, 데이터, 힙 영역 모두 독립적으로 할당받기 때문에 각 프로세스 간 메모리 구분이 필요하거나 독립된 주소 공간을 가져야 할 경우 사용합니다. 

### 멀티 프로세스의 장단점

장점

- 독립된 구조로 안전성이 높습니다.
- 프로세스 중 하나에 문제가 생겨도 다른 프로세스에 영향을 주지는 않습니다. 작업속도가 느려질 수는 있지만 작업이 정지되는 큰 문제가 발생하지 않습니다.

단점

- 독립된 메모리 영역을 할당 받기에 작업량이 많을수록, 즉 **Context Switching**이 자주 일어나서 주소 공간의 공유가 잦을 수록 오버헤드가 발생하여 성능저하가 발생할 수 있습니다.
- Context Switching 과정에서 캐시 메모리 초기화 등 무거운 작업이 진행되고 시간이 소모되는 등 오버헤드가 발생합니다.
  
  - 오버헤드(Overhead)란, 어떤 처리를 하기 위해 추가적으로 들어가는 간접적인 처리 시간, 메모리 등의 비용을 말합니다.

#### Context Switching

CPU는 한번에 하나의 프로세스만 실행할 수 있습니다. 하나를 실행하는 도중에 다른 작업을 해야할 경우, 실행하던 프로세스를 정지시켜놓고 다른 프로세스를 실행합니다.

이렇게 CPU가 여러 프로세스를 돌아가면서 작업하는 과정을 Context Switching이라고 합니다.

구체적으로는 동작 중인 프로세스를 정지시키면서 해당 프로세스의 상태(Context)를 고유의 PCB에 저장하고, 다음 순서의 프로세스의 상태를 복구하여 실행시키는 작업입니다.

### 멀티 스레드 Multi Thread

하나의 프로세스에 여러 스레드로 자원을 공유하며 작업을 나누어 수행하는 것을 말합니다.

### 멀티 스레드의 장단점

장점

- 시스템 자원소모 감소: 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어 자원을 효율적으로 관리할 수 있습니다.
- 시스템 처리율 향상: 실제로 일을 처리하는 실행 단위인 스레드 간에 데이터를 주고 받는 것이 간단해져서 시스템 자원 소모가 줄어듭니다. 또한 스레드 사이의 작업량이 작아 Context Switching이 빠릅니다. (캐시 메모리를 비울 필요가 없습니다.)
- 프로그램 응답 시간 단축: 스레드는 프로세스 내 메모리 영역을 공유(스택 제외)하기에 통신 비용이 적습니다. 또한 힙 영역을 공유하므로 데이터를 주고 받을 수 있습니다.

단점

- 자원을 공유하기에 동기화 문제가 발생할 수 있습니다. (병목현상, 데드락)
  - 데드락 Deadlock 이란, 둘 이상의 스레드가 lock을 획득하기 위해 기다리는데, lock을 잡고 있는 스레드도 똑같이 다른 lock을 기다리며 서로 블록 상태에 놓이는 것을 말합니다. 데드락은 다수의 스레드가 같은 lock을 동시에, 그러나 다른 명령에 의해 획득하려 할 때 발생합니다.
- 동일한 작업에 접근하는 일(=동기화)에 대한 설계와 디버깅이 어렵습니다. 
- 하나의 스레드에 문제가 생기면 전체 프로세스가 영향을 받습니다.

### 멀티 프로세스 vs. 멀티 스레드

|비고|멀티 프로세스|멀티 스레드|
|----|----------|----------|
|장점|하나의 프로세스가 죽더라도 다른 프로세스에는 여향을 끼치지 않고 정상적으로 수행됨|적은 메모리 공간을 차지하고 Context Switching이 빠름|
|단점|많은 메모리 공간과 CPU 시간을 차지함|하나의 스레드가 죽으면 전체 스레드가 종료될 수도 있음|

이 둘은 동시에 여러 작업을 수행한다는 점에서는 같지만 적용해야 하는 시스템에 따라 적절한 방식을 골라서 사용해야 합니다.


## 참고자료

<details><summary>펼치기</summary>
<div markdown="1">

-By Hooman Mallahzadeh - Own work, CC BY-SA 4.0, https://commons.wikimedia.org/w/index.php?curid=100534098
- https://gracefulprograming.tistory.com/22
- https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html
- https://ko.wikipedia.org/wiki/%EC%9A%B4%EC%98%81_%EC%B2%B4%EC%A0%9C
- https://blog.naver.com/NBlogTop.naver?isHttpsRedirect=true&blogId=sharonichoya&Redirect=Dlog&Qs=/sharonichoya/220501158281
- https://dev-ahn.tistory.com/15
- https://github.com/JaeYeopHan/Interview_Question_for_Beginner/tree/master/OS#%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%9D%98-%EC%B0%A8%EC%9D%B4
- https://parkcheolu.tistory.com/19

</div>
</details>
