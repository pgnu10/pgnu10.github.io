---
title: '[통계] 상관분석, 상관계수, p-value'
excerpt: '상관분석에 사용되는 가설검증, 상관계수, p-value에 대해 알아봅니다'
categories:
  - 통계
tags:
  - 통계
  - 상관분석
  - 가설검증
  - 상관계수
  - p-value
  - 비전공자를 위한
toc: true
toc_sticky: true
date: '2021-08-18'
lastmod: '2022-01-16'
---

# 상관 분석 Correlation Analysis

![ex_screenshot](/assets/images/Correlation_coefficient.png)

상관 분석이란 변수들 사이의 상관 관계를 수치화하여 분석하는 분석 기법입니다.

- 예를 들어, "부모의 키"(X)와 "자식의 키"(Y), "수학 성적"(X)과 "영어 성적"(Y) 등의 두 변수가 서로 얼마나 상관=연관이 있는지를 수치화합니다.

일반적으로 영국의 통계학자 Karl Pearson이 개발한 **Pearson 상관 분석**을 사용합니다.

## Pearson Correlation Analysis

피어슨 상관 분석은
> 두 연속형 변수 사이의 선형적인 상관성을 분석

하는 데에 사용합니다.

- 하나의 변수의 값이 증가할 때 다른 하나의 변수의 값도 같이 증가한다면 "양의 상관관계"가 있다고 표현하고
- 반대로 하나의 변수의 값이 증가할 때 다른 하나의 변수의 값은 감소한다면 "음의 상관관계"가 있다고 표현하고
- 이도저도 아니라면 "상관을 찾을 수 없다"고 표현합니다.

### 피어슨 상관 분석의 전제

#### 1. 두 변수는 모두 연속형 변수여야 합니다.

변수 값의 증감을 통해 상관 관계를 분석하는 기법이기 때문에 변수는 연속형 변수여야 합니다.

#### 2. 두 변수는 모두 정규성을 만족해야 합니다.

정규성이란 해당 변수의 분포가 정규분포를 따르는 것을 의미합니다.

- 변수의 분포가 한쪽으로 기울어져 있거나, 양 극단값만 존재한다거나 하는 경우처럼 정규분포와 크게 다를 경우, 정규성을 충족하지 못합니다.

분석할 변수가 정규성을 만족할 경우, 모수적인 통계 분석 방법을 사용할 수 있습니다. 피어슨 상관 분석은 모수적인 방법입니다.

- 두 변수 중 적어도 한 변수가 정규성을 만족한다면 피어슨 상관 분석을 사용할 수 있지만, 두 변수 모두 정규성을 만족하지 못한다면 스피어만 상관 분석, 켄달 상관 분석 등의 비모수적인 방법을 사용해야 합니다.

#### 3. 두 변수는 선형 관계를 가진다.

피어슨 상관 분석은 두 변수의 선형 관계를 수치화하는 분석 기법입니다.

만약 두 변수의 상관 관계가 선형 관계가 아닌 비선형 관계라면, 피어슨 상관 분석으로는 상관 관계가 없다고 분석될 수 있습니다.

- 따라서 선형 분석의 결과가 "상관 없음"으로 나오더라도 비선형 관계가 있을 수 있음을 염두해둬야 합니다.

### 피어슨 상관 분석의 과정

#### 1. 귀무가설과 대립가설을 설정합니다.
   
분석을 통해 얻고자 하는 목표를 설정하는 부분입니다.

귀무가설(=영가설, $$H_0$$)이란 지금까지 알려져 있는 일반적인 주장으로, 특별한 사유가 없다면 참으로 받아들여지는 가설입니다. 상관 분석에서는 "두 변수 사이에는 아무런 관계가 없다 (r = 0)"가 됩니다.

대립가설($$H_1$$)이란, 분석을 통해 검증하고자 하는 가설입니다. 상관 분석에서는 "두 변수 사이에는 유의미한 관계가 있다 (r $$\not ={}$$0)"가 됩니다.

- 학문에서는 새로운 지식에 대해 최대한 보수적으로 접근하려 하기 때문에, 통계 분석에서도 기존의 통념(귀무가설)을 반박하는(대립가설) 방식으로 가설검정이 진행됩니다.

#### 2. 두 변수가 피어슨 상관 분석을 진행하기에 적절한 변수인지 검증합니다.

정규성 조건의 경우, 중심극한정리에 의해 약 30~100개 이상의 표본이 존재한다면 정규성 조건을 충족한다고 가정할 수 있습니다.

- 보다 정확하게 정규성 검정을 실시하고 싶다면 Shapiro-Wilk test (표본 개수 2,000개 이하) 혹은 Kolmogorov-Smirnov test (표본 개수 2,000개 이상)을 사용합니다.
  
#### 3. 피어슨 상관 계수(r) 계산

$$ r_{X,Y}=\frac{cov(X,Y)}{\sigma_X \sigma_Y}=\frac{X와~Y의~공분산}{X의~표준편차*Y의~표준편차} = z\_score_{X}*z\_score_Y$$

피어슨 상관계수란 두 변수의 의존성(=공분산)을 표준화한 값입니다.

X와 Y의 공분산은 X의 편차와 Y의 편차를 곱해서 얻어집니다. 

- 따라서 X가 평균으로부터 증가할 때(=X의 편차가 양수일때) Y도 평균으로부터 증가하거나(=Y의 편차가 양수일때), X가 감소할 때 Y도 감소한다면 공분산 값은 양수가 되고
- 반대로 X가 감소할 때 Y가 증가하거나, X가 증가할 때 Y가 감소한다면 공분산 값은 음수가 됩니다.

1 달러와 1,000 원처럼 변수의 단위가 서로 다른 경우, 공분산만으로는 제대로 된 분석이 힘들기 때문에 공분산 값에 각각 변수의 표준편차를 나누어주어 그 값을 표준화 시킵니다.

이렇게 계산한 값을 상관계수(r)이라 하고, 그 값은 코시-슈바르츠 부등식에 의해 -1에서 +1 사이의 값을 갖습니다.

#### 4. 검정 통계량 계산

가설 검정을 할 때는 확률분포를 활용합니다.

먼저 주어진 데이터들이 일반 상식(=귀무가설)에서 이해할 수 있는 범위(=귀무가설의 확률분포) 안에 있다고 가정합니다.

그리고 통계 분석을 이용해 얻어진 통계값 (=검정 통계량)을 이용해서 주어진 데이터들이 일반 상식에서 이해할 수 있는 범위인지(=귀무가설 채택), 혹은 일반 상식에서는 이해할 수 없는 범위(=대립가설 채택)인지 확인합니다.

- 이렇게 사용하는 검정 통계량은 사용하는 검정의 종류에 따라 달라지며, 대표적으로 "Z 통계량", "t 통계량", "$$\chi^2$$(카이제곱) 통계량", "F 통계량"이 있습니다.

상관분석에서는 일반적으로 t-test를 이용합니다. t 통계량은 다음과 같이 구합니다. (n=데이터 개수)$$t=r\sqrt{\frac{n-2}{1-r^2}}$$

#### 5. 검정 통계량 해석

![ex_screenshot](/assets/images/Student_t_pdf.svg)

확률 이론에 따르면 위와 같이 구해진 t 통계량은 자유도가 n-2인 t 분포를 따릅니다.

즉, (위의 t 검정에서) 데이터 개수가 n개일 때 일반 상식에서 이해할 수 있는 범위(=분포)가 "자유도가 n-2인 t 분포"입니다.

그래서 해당 t 분포에서 계산한 검정 통계량, t 통계량이 어느 지점에 위치하는지 확인합니다. 만약 그 값이 해당 분포에서는 일어나기 어려운 일이라면 귀무가설을 기각하고 대립가설을 채택합니다.

- 만약 상관 분석 결과 구한 t score가 4 정도의 큰 값이 나온다면 이는 해당 분포에서는 일어날 확률이 매우 드믄 값일 것입니다. (그래프 참조)
- 따라서 이 경우 주어진 데이터는 일반 상식에서 이해할 수 있는 범위가 아니라고 결론 내릴 수 있겠습니다.

t 분포는 이미 자유도별로 값들이 계산되어진 t 분포표를 참고합니다.

#### 6. p-value 계산

![ex_screenshot](/assets/images/t_dist_eg.jpg)

p-value는 posibility value라는 뜻으로, 계산한 t score 값이 해당 분포에서 나올 확률을 의미합니다.

상관 분석에서는 대립가설이 "양의 상관이 있다" 혹은 "음의 상관이 있다"인 경우 각 부호에 맞는 p-value만을 확인하게 됩니다. 위 사진을 참고하면 이 경우 $$p=0.019$$가 됩니다.

대립가설이 단순히 "상관이 있다"인 경우 양방향의 p-value를 더해 최종 p-value를 산출합니다. 이 경우 $$p=0.038$$이 됩니다.


#### 7. 기각영역 설정 및 가설 채택

![ex_screenshot](/assets/images/Standard_deviation_diagram.svg)

기각영역은 위에서 구한 p-value가 몇 % 이하일 경우에 귀무가설을 기각할지 결정하는 기준이 되는 영역입니다.

사회과학 분야 논문에서는 일반적으로 $$p<0.05, 0.01,0.001$$ 영역의 유의 수준 강도를 사용하며, 각각 *, **, *** 으로 표기합니다.

- 6번 항목 사진 예시의 경우 $$0.01 < p=0.019 < 0.05$$ 이기 때문에 r = 0.7 이었다면 `r = + 0.7 *`과 같은 식으로 표기하며 `"유의 수준 0.05 수준에서 두 변수는 0.7의 양의 상관 관계를 보인다"`고 합니다.

계산 결과 t score가 기각영역에 속한다면 귀무가설을 기각하고 대립가설을 채택할 수 있습니다.

## 참고자료

<details><summary>펼치기</summary>
<div markdown="1">

- 자유아카데미, "수리통계학 5판", 송성주 정명식 지음
- https://lunch-box.tistory.com/94
- https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=libido1014&logNo=120115838312
- https://ko.wikipedia.org/wiki/%ED%94%BC%EC%96%B4%EC%8A%A8_%EC%83%81%EA%B4%80_%EA%B3%84%EC%88%98
- https://blog.naver.com/istech7/50153288534
- https://blog.naver.com/sw4r/221025662499
- https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=vi_football&logNo=221454949642
- https://math100.tistory.com/74?category=836925
- https://upload.wikimedia.org/wikipedia/commons/3/34/Correlation_coefficient.png
- By M. W. Toews - Own work, based (in concept) on figure by Jeremy Kemp, on 2005-02-09, CC BY 2.5, https://commons.wikimedia.org/w/index.php?curid=1903871
- By Skbkekas - 자작, CC BY 3.0, https://commons.wikimedia.org/w/index.php?curid=9546828
</div>
</details>
